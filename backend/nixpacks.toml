# Nixpacks configuration for Railway
# This ensures we use Python 3.11 and install CPU-only PyTorch to keep the image size small.

[phases.setup]
nixPkgs = ["python311", "gcc"]

[phases.install]
cmds = [
    # Install CPU-only torch first to avoid pulling the 4GB+ GPU version
    "pip install torch --index-url https://download.pytorch.org/whl/cpu",
    "pip install -r requirements.txt"
]

[start]
# Same command as in Procfile, but Nixpacks can use this directly
cmd = "python -m app.rag.ingest && uvicorn app.main:app --host 0.0.0.0 --port $PORT"
